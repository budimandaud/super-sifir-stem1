<!DOCTYPE html>
<html lang="ms">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Login Guru - Super Sifir Digital STEM1</title>

<style>
body{
  font-family:"Segoe UI",Arial,sans-serif;
  background:#f5f7fb;
  padding:20px;
}

.container{
  max-width:420px;
  margin:auto;
  background:white;
  padding:25px;
  border-radius:12px;
  box-shadow:0 4px 12px rgba(0,0,0,0.08);
  text-align:center;
}

h1{
  margin-bottom:5px;
  color:#1e40af;
}

h3{
  margin-top:0;
  color:#444;
  font-weight:normal;
}

input,button{
  width:100%;
  padding:10px;
  margin:8px 0;
  border-radius:8px;
  border:1px solid #ddd;
  font-size:14px;
}

button{
  background:#2563eb;
  color:white;
  border:none;
  font-weight:bold;
  cursor:pointer;
  transition:0.2s;
}

button:hover{
  background:#1d4ed8;
}

#error{
  color:red;
  margin-top:8px;
  font-size:13px;
}
</style>
</head>


<body>

<div class="container">

<h1>Super Sifir Digital STEM1</h1>
<h3>üîê Login Guru</h3>


<input type="text" id="username" placeholder="Username" autocomplete="username">

<input type="password" id="password" placeholder="Password" autocomplete="current-password">


<button onclick="login()">Login</button>

<p id="error"></p>


<button onclick="location.href='index.html'" style="background:#6b7280;margin-top:10px;">
üè† Menu Utama
</button>

</div>


<script>

const API_URL = "https://uziefozgozmnckfssoyv.supabase.co";
const API_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV6aWVmb3pnb3ptbmNrZnNzb3l2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEwOTI5NTQsImV4cCI6MjA4NjY2ODk1NH0.YNfUm4BF3gKN3C0luUKN445BYcHYiD7OhAmkKTFOW-A";


// ================= LOGIN =================
async function login(){

  const username = document.getElementById("username").value.trim();
  const password = document.getElementById("password").value.trim();


  if(!username || !password){

    document.getElementById("error").innerText="‚ùó Sila isi semua ruangan";
    return;

  }


  document.getElementById("error").innerText="‚è≥ Sedang log masuk...";


  const u = encodeURIComponent(username);
  const p = encodeURIComponent(password);


  const url = `${API_URL}/rest/v1/teachers?select=id,nama&username=eq.${u}&password=eq.${p}`;


  try{

    const res = await fetch(url,{

      headers:{
        apikey:API_KEY,
        Authorization:`Bearer ${API_KEY}`
      }

    });


    if(!res.ok){
      throw new Error("Network error");
    }


    const data = await res.json();


    if(data.length===1){

      // Simpan session
      localStorage.setItem("login","true");
      localStorage.setItem("teacher_id",data[0].id);
      localStorage.setItem("teacher_name",data[0].nama);


      // Redirect asal
      const redirect = localStorage.getItem("redirect_after_login");


      if(redirect){

        localStorage.removeItem("redirect_after_login");
        location.href = redirect;

      }else{

        location.href = "ujian.html";

      }


    }else{

      document.getElementById("error").innerText="‚ùå Username atau password salah";

    }

  }catch(err){

    console.error(err);

    document.getElementById("error").innerText="‚ùå Ralat sistem. Cuba lagi.";

  }

}

</script>

</body>
</html>

