<!DOCTYPE html>
<html lang="ms">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Latihan Hafal Sifir</title>

<style>
body{
  font-family:"Segoe UI",Arial,sans-serif;
  background:linear-gradient(135deg,#2563eb,#1e40af);
  min-height:100vh;
  margin:0;
  display:flex;
  justify-content:center;
  align-items:center;
}

.card{
  background:white;
  width:100%;
  max-width:450px;
  padding:25px;
  border-radius:16px;
  box-shadow:0 12px 25px rgba(0,0,0,0.15);
  text-align:center;
}

h1{color:#1e40af;margin-bottom:5px;}
.subtitle{font-size:13px;color:#555;margin-bottom:15px;}

select,input{
  width:100%;
  padding:10px;
  margin:6px 0;
  border-radius:8px;
  border:1px solid #ddd;
}

button{
  width:100%;
  padding:10px;
  margin:6px 0;
  border:none;
  border-radius:8px;
  font-weight:bold;
  cursor:pointer;
}

.btn-start{background:#10b981;color:white;}
.btn-check{background:#2563eb;color:white;}
.btn-end{background:#ef4444;color:white;}
.btn-home{background:#6b7280;color:white;}

.soalan{
  font-size:28px;
  font-weight:bold;
  margin:15px 0;
  color:#2563eb;
}

.score{
  display:flex;
  justify-content:space-between;
  font-size:13px;
  font-weight:bold;
}

#msg{font-weight:bold;margin:5px 0;}
.hidden{display:none;}
</style>
</head>

<body>

<div class="card">

<h1>Latihan Sifir</h1>
<div class="subtitle">Pilih Nama & Mula Latihan üéØ</div>

<!-- PILIHAN -->
<label>Kelas</label>
<select id="kelasSelect">
  <option value="">Pilih Kelas</option>
</select>

<label>Nama Murid</label>
<select id="muridSelect">
  <option value="">Pilih Murid</option>
</select>

<label>Sifir</label>
<select id="sifir">
  <option value="">Pilih</option>
  <option>1</option><option>2</option><option>3</option>
  <option>4</option><option>5</option><option>6</option>
  <option>7</option><option>8</option><option>9</option>
  <option>10</option><option>11</option><option>12</option>
</select>

<label>Mode</label>
<select id="mode">
  <option value="urutan">Ikut Urutan</option>
  <option value="rawak">Rawak</option>
</select>

<button class="btn-start" onclick="start()">‚ñ∂Ô∏è Mula Latihan</button>


<!-- AREA SOALAN -->
<div id="area" class="hidden">

<div id="soalan" class="soalan"></div>

<input type="number" id="jawapan" placeholder="Jawapan">

<button class="btn-check" onclick="semak()">Semak</button>
<button class="btn-end" onclick="tamat()">Tamat & Simpan</button>

<p id="msg"></p>

<div class="score">
  <div>Betul: <span id="betul">0</span></div>
  <div>Salah: <span id="salah">0</span></div>
</div>

</div>

<br>
<button class="btn-home" onclick="location.href='index.html'">üè† Menu Utama</button>

</div>


<script>

const API_URL="https://uziefozgozmnckfssoyv.supabase.co";
const API_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV6aWVmb3pnb3ptbmNrZnNzb3l2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEwOTI5NTQsImV4cCI6MjA4NjY2ODk1NH0.YNfUm4BF3gKN3C0luUKN445BYcHYiD7OhAmkKTFOW-A"; // <-- pastikan key betul

let students=[];
let student_id=null;
let sifir=0;
let current=1;
let jawapanBetul=0;
let betul=0;
let salah=0;


// ================= LOAD STUDENT =================
async function loadStudents(){

  const res = await fetch(`${API_URL}/rest/v1/students?select=id,nama,kelas`,{
    headers:{
      apikey:API_KEY,
      Authorization:`Bearer ${API_KEY}`
    }
  });

  students = await res.json();


  const kelasSet = new Set(students.map(s=>s.kelas));

  const kelasSelect = document.getElementById("kelasSelect");

  // Reset
  kelasSelect.innerHTML =
    '<option value="">Pilih Kelas</option>';

  kelasSet.forEach(k=>{

    const o = document.createElement("option");
    o.value = k;
    o.textContent = k;
    kelasSelect.appendChild(o);

  });


  document.getElementById("muridSelect").innerHTML =
    '<option value="">Pilih Murid</option>';
}


// ================= UPDATE MURID =================
function updateMurid(){

  const kelas = document.getElementById("kelasSelect").value;
  const murid = document.getElementById("muridSelect");

  murid.innerHTML =
    '<option value="">Pilih Murid</option>';

  students.forEach(s=>{

    if(s.kelas===kelas){

      const o=document.createElement("option");
      o.value=s.id;
      o.textContent=s.nama;
      murid.appendChild(o);

    }

  });

}

document.getElementById("kelasSelect")
  .addEventListener("change",updateMurid);


// ================= START =================
function start(){

  student_id =
    document.getElementById("muridSelect").value;

  sifir =
    parseInt(document.getElementById("sifir").value);


  if(!student_id||!sifir){

    alert("Lengkapkan semua pilihan");
    return;

  }


  betul=0;
  salah=0;
  current=1;

  document.getElementById("betul").innerText=0;
  document.getElementById("salah").innerText=0;

  document.getElementById("area")
    .classList.remove("hidden");

  next();

}


// ================= NEXT =================
function next(){

  const mode =
    document.getElementById("mode").value;

  let g;


  if(mode==="urutan"){

    g=current;
    current++;

    if(current>12) current=1;

  }else{

    g = Math.floor(Math.random()*12)+1;

  }


  jawapanBetul = sifir * g;

  document.getElementById("soalan")
    .innerText = `${sifir} √ó ${g} = ?`;

  document.getElementById("jawapan").value="";
  document.getElementById("msg").innerText="";

}


// ================= SEMAK =================
function semak(){

  const j =
    parseInt(document.getElementById("jawapan").value);

  if(isNaN(j)) return;


  const msg = document.getElementById("msg");


  if(j===jawapanBetul){

    betul++;

    msg.innerText="‚úÖ Betul!";
    msg.style.color="green";

  }else{

    salah++;

    msg.innerText=`‚ùå Salah (${jawapanBetul})`;
    msg.style.color="red";

  }


  document.getElementById("betul").innerText=betul;
  document.getElementById("salah").innerText=salah;


  // Auto next
  setTimeout(()=>{
    next();
  },800);

}


// ================= TAMAT =================
async function tamat(){

  await fetch(`${API_URL}/rest/v1/latihan_scores`,{

    method:"POST",

    headers:{
      "Content-Type":"application/json",
      apikey:API_KEY,
      Authorization:`Bearer ${API_KEY}`
    },

    body:JSON.stringify({
      student_id,
      betul,
      salah,
      sifir
    })

  });

  alert("Rekod latihan disimpan!");
  location.reload();

}


// ENTER KEY
document.getElementById("jawapan")
  .addEventListener("keydown",e=>{
    if(e.key==="Enter") semak();
  });


// START LOAD
loadStudents();

</script>

</body>
</html>

